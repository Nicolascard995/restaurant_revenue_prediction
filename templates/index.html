<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Advisor - Viability Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2">
                    <i class="fas fa-utensils mr-3"></i>
                    Restaurant Advisor
                </h1>
                <p class="text-xl opacity-90">Your intelligent assistant for opening a successful restaurant</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Form Section -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-chart-line mr-2 text-blue-600"></i>
                    Viability Analysis
                </h2>
                
                <form id="restaurantForm" class="space-y-6">
                    <!-- Market Analysis Section -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-globe mr-2 text-blue-600"></i>
                            Market Analysis
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    City
                                </label>
                                <input type="text" name="city" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., Madrid, Barcelona, New York">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    City Type
                                </label>
                                <select name="city_group" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select...</option>
                                    <option value="Big Cities">Big City</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Restaurant Type
                                </label>
                                <select name="type" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select...</option>
                                    <option value="FC">Fast Casual</option>
                                    <option value="IL">Informal Dining</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Opening Date
                                </label>
                                <input type="date" name="open_date" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Demographic Information -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-users mr-2 text-green-600"></i>
                            Demographic Information
                        </h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Average Household Income ($)
                                </label>
                                <input type="number" name="avg_income" min="0"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 50000">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Population Density
                                </label>
                                <select name="population_density"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select...</option>
                                    <option value="High">High Density</option>
                                    <option value="Medium">Medium Density</option>
                                    <option value="Low">Low Density</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Average Age
                                </label>
                                <input type="number" name="avg_age" min="0" max="100"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 35">
                            </div>
                        </div>
                    </div>

                    <!-- Economic Indicators -->
                    <div class="border-b pb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-chart-line mr-2 text-purple-600"></i>
                            Economic Indicators
                        </h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Unemployment Rate (%)
                                </label>
                                <input type="number" name="unemployment_rate" min="0" max="100" step="0.1"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 5.2">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    GDP Growth Rate (%)
                                </label>
                                <input type="number" name="gdp_growth" min="-50" max="50" step="0.1"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 2.5">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Inflation Rate (%)
                                </label>
                                <input type="number" name="inflation_rate" min="0" max="100" step="0.1"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 3.1">
                            </div>
                        </div>
                    </div>

                    <!-- Financial Information -->
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-dollar-sign mr-2 text-green-600"></i>
                            Financial Information
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Initial Investment ($)
                                </label>
                                <input type="number" name="investment" required min="0"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 500000">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Monthly Operating Costs ($)
                                </label>
                                <input type="number" name="monthly_costs" required min="0"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 15000">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Average Meal Price ($)
                                </label>
                                <input type="number" name="avg_meal_price" min="0" step="0.01"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 25.50">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Expected Daily Customers
                                </label>
                                <input type="number" name="daily_customers" min="0"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 150">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Food Cost Percentage (%)
                                </label>
                                <input type="number" name="food_cost_percentage" min="0" max="100" step="0.1"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 30.0">
                            </div>
                        </div>
                    </div>

                    <!-- Competition & Market Analysis -->
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-store mr-2 text-orange-600"></i>
                            Competition & Market Analysis
                        </h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Number of Competitors
                                </label>
                                <input type="number" name="competitors_count" min="0"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="e.g., 15">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Market Saturation Level
                                </label>
                                <select name="market_saturation"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select...</option>
                                    <option value="Low">Low Saturation</option>
                                    <option value="Medium">Medium Saturation</option>
                                    <option value="High">High Saturation</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Seasonal Demand Factor
                                </label>
                                <select name="seasonal_demand"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select...</option>
                                    <option value="High">High Seasonal</option>
                                    <option value="Medium">Medium Seasonal</option>
                                    <option value="Low">Low Seasonal</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        <button type="submit" 
                                class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Analyze Viability
                        </button>
                        
                        <button type="button" id="aiAdviceBtn"
                                class="flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200">
                            <i class="fas fa-robot mr-2"></i>
                            AI Advice
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="results" class="hidden">
                <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-chart-pie mr-2 text-green-600"></i>
                        Analysis Results
                    </h2>
                    
                    <div id="analysisResults" class="space-y-6">
                        <!-- Results will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- AI Advice Section -->
            <div id="aiAdvice" class="hidden">
                <div class="bg-white rounded-lg shadow-xl p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-lightbulb mr-2 text-yellow-600"></i>
                        Artificial Intelligence Advice
                    </h2>
                    
                    <div id="adviceContent" class="prose max-w-none">
                        <!-- Advice will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Spinner -->
    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-700">Analyzing your project...</p>
        </div>
    </div>

    <script>
        document.getElementById('restaurantForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // Show loading
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result);
                } else {
                    alert('Error in analysis');
                }
            } catch (error) {
                alert('Connection error');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        });

        document.getElementById('aiAdviceBtn').addEventListener('click', async () => {
            const formData = new FormData(document.getElementById('restaurantForm'));
            const data = Object.fromEntries(formData.entries());
            
            if (!data.city || !data.type) {
                alert('Please complete the basic information first');
                return;
            }
            
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                const response = await fetch('/api/ai_advice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayAdvice(result.advice);
                } else {
                    alert('Error getting advice');
                }
            } catch (error) {
                alert('Connection error');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        });

        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const analysisDiv = document.getElementById('analysisResults');
            
            const viability = result.viability_analysis;
            const revenue = result.revenue_estimate;
            
            analysisDiv.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800 mb-4">
                            <i class="fas fa-chart-line mr-2"></i>
                            Revenue Estimate
                        </h3>
                        <p class="text-3xl font-bold text-blue-600">
                            $${revenue.toLocaleString()}
                        </p>
                        <p class="text-sm text-blue-600 mt-2">Estimated annual revenue</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-800 mb-4">
                            <i class="fas fa-check-circle mr-2"></i>
                            Viability
                        </h3>
                        <p class="text-3xl font-bold text-green-600">
                            ${viability.viability === 'Alta' ? 'High' : 'Low'}
                        </p>
                        <p class="text-sm text-green-600 mt-2">Viability level</p>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 mt-6">
                    <div class="bg-white border border-gray-200 p-6 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">ROI</h4>
                        <p class="text-2xl font-bold text-gray-900">${viability.roi.toFixed(1)}%</p>
                    </div>
                    
                    <div class="bg-white border border-gray-200 p-6 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Annual Profit</h4>
                        <p class="text-2xl font-bold text-gray-900">$${viability.annual_profit.toLocaleString()}</p>
                    </div>
                    
                    <div class="bg-white border border-gray-200 p-6 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Annual Revenue</h4>
                        <p class="text-2xl font-bold text-gray-900">$${viability.annual_revenue.toLocaleString()}</p>
                    </div>
                </div>
            `;
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayAdvice(advice) {
            const adviceDiv = document.getElementById('aiAdvice');
            const contentDiv = document.getElementById('adviceContent');
            
            contentDiv.innerHTML = `
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-lg">
                    <p class="text-gray-800 leading-relaxed">${advice}</p>
                </div>
            `;
            
            adviceDiv.classList.remove('hidden');
            adviceDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html> 